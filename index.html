<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>Moodboard Generator</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
  body {
    font-family: sans-serif;
    background: #7f5af0;
    margin: 0;
    padding: 20px;
    display: flex;
    justify-content: center;
  }
  .container {
    background: #fff;
    border-radius: 20px;
    padding: 20px;
    max-width: 1000px;
    width: 100%;
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
  }
  h1 {
    text-align: center;
    margin-bottom: 10px;
  }
  .upload {
    border: 2px dashed #ccc;
    padding: 20px;
    text-align: center;
    cursor: pointer;
    border-radius: 10px;
    margin-bottom: 20px;
  }
  .preview-images {
    display: flex;
    gap: 10px;
    overflow-x: auto;
    margin-bottom: 20px;
  }
  .preview-item {
    position: relative;
    min-width: 80px;
    height: 60px;
    border-radius: 8px;
    overflow: hidden;
    border: 2px solid transparent;
    cursor: pointer;
  }
  .preview-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  .remove-preview {
    position: absolute;
    top: 4px;
    right: 4px;
    background: rgba(239,68,68,0.9);
    color: #fff;
    font-size: 12px;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
  }
  .layout-selector {
    display: grid;
    grid-template-columns: repeat(2, 1fr); /* 2 colonnes */
    gap: 10px;
    margin-bottom: 20px;
  }
  .layout-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    padding: 10px;
    background: #fff;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    cursor: pointer;
    transition: all .18s;
    color: #4a5568;
    font-size: 0.9rem;
  }
  .layout-btn.active {
    background: #7f5af0;
    border-color: #7f5af0;
    color: white;
  }
  .moodboard-canvas {
    background: #f8fafc;
    border-radius: 12px;
    position: relative;
    height: 500px;
    overflow: hidden;
    margin-bottom: 20px;
  }
  .image-item {
    position: absolute;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 6px 14px rgba(0,0,0,0.12);
  }
  .image-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  .image-controls {
    position: absolute;
    top: -8px;
    right: -8px;
    background: #7f5af0;
    color: #fff;
    width: 22px;
    height: 22px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 13px;
    cursor: pointer;
    opacity: 0;
  }
  .image-item:hover .image-controls {
    opacity: 1;
  }
  .actions {
    display: flex;
    gap: 10px;
    justify-content: center;
    flex-wrap: wrap;
  }
  .btn {
    padding: 10px 16px;
    border-radius: 8px;
    background: #7f5af0;
    color: #fff;
    border: none;
    cursor: pointer;
    font-weight: 600;
  }
  .btn-secondary {
    background: #718096;
  }
</style>
</head>
<body>
  <div class="container">
    <h1>üé® Moodboard Generator</h1>

    <!-- Upload -->
    <div class="upload" onclick="document.getElementById('fileInput').click()"
         ondrop="dropHandler(event)" ondragover="dragOverHandler(event)" ondragleave="dragLeaveHandler(event)">
      Cliquez ou d√©posez vos images ici
      <input id="fileInput" type="file" accept="image/*" multiple style="display:none"
             onchange="fileChangeHandler(this.files)">
    </div>

    <!-- Preview -->
    <div id="previewImages" class="preview-images"></div>

    <!-- Layouts -->
    <div class="layout-selector">
      <div class="layout-btn active" onclick="selectLayout(this,'pinterest')">Pinterest</div>
      <div class="layout-btn" onclick="selectLayout(this,'grid')">Grille</div>
      <div class="layout-btn" onclick="selectLayout(this,'collage')">Collage</div>
      <div class="layout-btn" onclick="selectLayout(this,'minimal')">Minimal</div>
    </div>

    <!-- Canvas -->
    <div id="moodboardCanvas" class="moodboard-canvas">
      <div id="canvasPlaceholder" style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#a0aec0">
        Votre mood board appara√Ætra ici
      </div>
    </div>

    <!-- Actions -->
    <div class="actions">
      <button class="btn" onclick="generateMoodboard()">‚ú® G√©n√©rer</button>
      <button class="btn btn-secondary" onclick="shuffleLayout()">üîÑ M√©langer</button>
      <button class="btn btn-secondary" onclick="clearCanvas()">üóëÔ∏è Vider</button>
      <button class="btn" onclick="exportAsImage()">‚¨áÔ∏è T√©l√©charger</button>
    </div>
  </div>

<script>
let uploadedImages = [];
let currentLayout = 'pinterest';

function dragOverHandler(e){ e.preventDefault(); }
function dragLeaveHandler(e){ e.preventDefault(); }
function dropHandler(e){
  e.preventDefault();
  processFiles([...e.dataTransfer.files]);
}
function fileChangeHandler(files){
  processFiles([...files]);
}
function processFiles(files){
  files.forEach(file=>{
    if(!file.type.startsWith("image/")) return;
    const reader=new FileReader();
    reader.onload=e=>{
      uploadedImages.push({id:Date.now()+Math.random(),src:e.target.result,name:file.name});
      updatePreview();
    };
    reader.readAsDataURL(file);
  });
}
function updatePreview(){
  const container=document.getElementById('previewImages');
  container.innerHTML="";
  uploadedImages.forEach(img=>{
    const div=document.createElement('div');
    div.className="preview-item";
    div.onclick=()=>addToCanvas(img.id);
    const image=document.createElement('img');
    image.src=img.src;
    div.appendChild(image);
    const remove=document.createElement('div');
    remove.className="remove-preview";
    remove.textContent="√ó";
    remove.onclick=e=>{e.stopPropagation();removeImage(img.id)};
    div.appendChild(remove);
    container.appendChild(div);
  });
}
function removeImage(id){
  uploadedImages=uploadedImages.filter(i=>i.id!==id);
  updatePreview();
}
function selectLayout(el,layout){
  currentLayout=layout;
  document.querySelectorAll('.layout-btn').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
}
function generateMoodboard(){
  if(uploadedImages.length===0){
    alert("Veuillez d'abord ajouter des images !");
    return;
  }
  const canvas=document.getElementById('moodboardCanvas');
  const width=canvas.clientWidth, height=canvas.clientHeight;
  canvas.innerHTML="";
  const positions=generateLayout(uploadedImages.length,width,height);
  uploadedImages.forEach((img,i)=>{
    const pos=positions[i];
    const item=document.createElement('div');
    item.className="image-item";
    item.style.left=pos.x+"px";
    item.style.top=pos.y+"px";
    item.style.width=pos.width+"px";
    item.style.height=pos.height+"px";
    const image=document.createElement('img');
    image.src=img.src;
    item.appendChild(image);
    const ctrl=document.createElement('div');
    ctrl.className="image-controls";
    ctrl.textContent="√ó";
    ctrl.onclick=(e)=>{e.stopPropagation();item.remove()};
    item.appendChild(ctrl);
    canvas.appendChild(item);
  });
}
function generateLayout(count,w,h){
  const positions=[];
  const margin=10;
  if(currentLayout==='grid'){
    const cols=Math.ceil(Math.sqrt(count));
    const itemW=(w-(cols+1)*margin)/cols;
    const itemH=itemW*0.75;
    for(let i=0;i<count;i++){
      const row=Math.floor(i/cols),col=i%cols;
      positions.push({x:margin+col*(itemW+margin),y:margin+row*(itemH+margin),width:itemW,height:itemH});
    }
  }else if(currentLayout==='pinterest'){
    const cols=3;
    const colW=(w-(cols+1)*margin)/cols;
    const colHeights=new Array(cols).fill(margin);
    for(let i=0;i<count;i++){
      const col=colHeights.indexOf(Math.min(...colHeights));
      const hImg=120+Math.random()*80;
      positions.push({x:margin+col*(colW+margin),y:colHeights[col],width:colW,height:hImg});
      colHeights[col]+=hImg+margin;
    }
  }else if(currentLayout==='collage'){
    for(let i=0;i<count;i++){
      const size=100+Math.random()*100;
      positions.push({x:Math.random()*(w-size),y:Math.random()*(h-size),width:size,height:size*0.7});
    }
  }else if(currentLayout==='minimal'){
    const itemW=Math.min(200,(w-60)/2);
    for(let i=0;i<Math.min(count,6);i++){
      const row=Math.floor(i/2),col=i%2;
      positions.push({x:20+col*(itemW+20),y:20+row*(itemW*0.7+20),width:itemW,height:itemW*0.7});
    }
  }
  return positions;
}
function shuffleLayout(){ generateMoodboard(); }
function clearCanvas(){
  document.getElementById('moodboardCanvas').innerHTML=
    '<div id="canvasPlaceholder" style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#a0aec0">Votre mood board appara√Ætra ici</div>';
}
function addToCanvas(id){
  const img=uploadedImages.find(i=>i.id===id);
  if(!img) return;
  const canvas=document.getElementById('moodboardCanvas');
  const w=120,h=90;
  const item=document.createElement('div');
  item.className="image-item";
  item.style.left=(canvas.clientWidth/2-w/2)+"px";
  item.style.top=(canvas.clientHeight/2-h/2)+"px";
  item.style.width=w+"px";
  item.style.height=h+"px";
  const image=document.createElement('img');
  image.src=img.src;
  item.appendChild(image);
  const ctrl=document.createElement('div');
  ctrl.className="image-controls";
  ctrl.textContent="√ó";
  ctrl.onclick=()=>item.remove();
  item.appendChild(ctrl);
  canvas.appendChild(item);
}
function exportAsImage(){
  const canvas=document.getElementById('moodboardCanvas');
  html2canvas(canvas).then(c=>{
    const link=document.createElement('a');
    link.download='moodboard.png';
    link.href=c.toDataURL();
    link.click();
  });
}
</script>
</body>
</html>
