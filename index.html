<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>Moodboard Generator</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
  body {
    font-family: sans-serif;
    background: transparent;
    margin: 0;
    padding: 10px;
    display: flex;
    justify-content: center;
  }
  .container {
    background: #fff;
    border-radius: 16px;
    padding: 16px;
    max-width: 900px;
    width: 100%;
  }
  h1 {
    text-align: center;
    margin-bottom: 10px;
  }
  .upload {
    border: 2px dashed #ccc;
    padding: 16px;
    text-align: center;
    cursor: pointer;
    border-radius: 10px;
    margin-bottom: 20px;
  }
  .preview-images {
    display: flex;
    gap: 10px;
    overflow-x: auto;
    margin-bottom: 20px;
  }
  .preview-item {
    position: relative;
    min-width: 70px;
    height: 55px;
    overflow: hidden;
  }
  .preview-item img {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }
  .remove-preview {
    position: absolute;
    top: 4px;
    right: 4px;
    background: rgba(239,68,68,0.9);
    color: #fff;
    font-size: 12px;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
  }
  .controls h3 {
    margin-bottom: 8px;
    color: #4a5568;
    font-size: 1rem;
  }
  .layout-selector {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
    margin-bottom: 20px;
  }
  .layout-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    padding: 10px;
    background: #fff;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    cursor: pointer;
    transition: all .18s;
    color: #4a5568;
    font-size: 0.85rem;
    text-align: center;
  }
  .layout-btn.active {
    background: #E0EBDB;
    border-color: #E0EBDB;
    color: black;
  }
  .layout-preview {
    width: 40px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .moodboard-canvas {
    background: #f8fafc;
    border-radius: 12px;
    position: relative;
    height: 500px;
    overflow: hidden;
    margin-bottom: 20px;
  }
  .image-item {
    position: absolute;
  }
  .image-item img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    display: block;
  }
  .image-controls {
    display: none; /* ‚ùå plus de bouton sur les images */
  }
  .actions {
    display: flex;
    gap: 8px;
    justify-content: center;
    flex-wrap: wrap;
  }
  .btn {
    padding: 8px 14px;
    border-radius: 8px;
    background: #E0EBDB;
    color: #000;
    border: none;
    cursor: pointer;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .btn img {
    width: 16px;
    height: 16px;
  }
  .btn-secondary {
    background: #718096;
    color: #fff;
  }
</style>
</head>
<body>
  <div class="container">
    <h1>üé® Moodboard Generator</h1>

    <!-- Upload -->
    <div class="upload" onclick="document.getElementById('fileInput').click()"
         ondrop="dropHandler(event)" ondragover="dragOverHandler(event)" ondragleave="dragLeaveHandler(event)">
      Cliquez ou d√©posez vos images ici
      <input id="fileInput" type="file" accept="image/*" multiple style="display:none"
             onchange="fileChangeHandler(this.files)">
    </div>

    <!-- Preview -->
    <div id="previewImages" class="preview-images"></div>

    <!-- Layout -->
    <div class="controls">
      <h3>Choisissez un style :</h3>
      <div class="layout-selector">
        <div class="layout-btn active" onclick="selectLayout(this,'pinterest')">
          <div class="layout-preview">
            <!-- Aper√ßu Pinterest -->
            <svg width="40" height="30" xmlns="http://www.w3.org/2000/svg">
              <rect x="1" y="1" width="11" height="15" fill="currentColor" opacity="0.7"/>
              <rect x="14" y="1" width="11" height="10" fill="currentColor" opacity="0.7"/>
              <rect x="27" y="1" width="11" height="18" fill="currentColor" opacity="0.7"/>
              <rect x="14" y="13" width="11" height="8" fill="currentColor" opacity="0.7"/>
            </svg>
          </div>
          Pinterest
        </div>
        <div class="layout-btn" onclick="selectLayout(this,'grid')">
          <div class="layout-preview">
            <!-- Aper√ßu Grille -->
            <svg width="40" height="30" xmlns="http://www.w3.org/2000/svg">
              <rect x="2" y="2" width="10" height="8" fill="currentColor" opacity="0.7"/>
              <rect x="15" y="2" width="10" height="8" fill="currentColor" opacity="0.7"/>
              <rect x="28" y="2" width="10" height="8" fill="currentColor" opacity="0.7"/>
              <rect x="2" y="12" width="10" height="8" fill="currentColor" opacity="0.7"/>
              <rect x="15" y="12" width="10" height="8" fill="currentColor" opacity="0.7"/>
              <rect x="28" y="12" width="10" height="8" fill="currentColor" opacity="0.7"/>
            </svg>
          </div>
          Grille
        </div>
        <div class="layout-btn" onclick="selectLayout(this,'collage')">
          <div class="layout-preview">
            <!-- Aper√ßu Collage -->
            <svg width="40" height="30" xmlns="http://www.w3.org/2000/svg">
              <rect x="3" y="4" width="12" height="9" fill="currentColor" opacity="0.7" transform="rotate(-5 9 8.5)"/>
              <rect x="18" y="2" width="8" height="12" fill="currentColor" opacity="0.7" transform="rotate(8 22 8)"/>
              <rect x="28" y="8" width="10" height="7" fill="currentColor" opacity="0.7" transform="rotate(-3 33 11.5)"/>
              <rect x="8" y="16" width="9" height="6" fill="currentColor" opacity="0.7" transform="rotate(12 12.5 19)"/>
            </svg>
          </div>
          Collage
        </div>
        <div class="layout-btn" onclick="selectLayout(this,'minimal')">
          <div class="layout-preview">
            <!-- Aper√ßu Minimal -->
            <svg width="40" height="30" xmlns="http://www.w3.org/2000/svg">
              <rect x="8" y="6" width="8" height="6" fill="currentColor" opacity="0.7"/>
              <rect x="24" y="6" width="8" height="6" fill="currentColor" opacity="0.7"/>
              <rect x="8" y="18" width="8" height="6" fill="currentColor" opacity="0.7"/>
              <rect x="24" y="18" width="8" height="6" fill="currentColor" opacity="0.7"/>
            </svg>
          </div>
          Minimal
        </div>
      </div>
    </div>

    <!-- Canvas -->
    <div id="moodboardCanvas" class="moodboard-canvas">
      <div id="canvasPlaceholder" style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#a0aec0">
        Votre mood board appara√Ætra ici
      </div>
    </div>

    <!-- Actions -->
    <div class="actions">
      <button class="btn" onclick="generateMoodboard()">
        <img src="https://img.icons8.com/ios/50/sparkle.png" alt=""> G√©n√©rer
      </button>
      <button class="btn btn-secondary" onclick="shuffleLayout()">
        <img src="https://img.icons8.com/ios/50/shuffle.png" alt=""> M√©langer
      </button>
      <button class="btn btn-secondary" onclick="clearCanvas()">
        <img src="https://img.icons8.com/ios/50/trash.png" alt=""> Vider
      </button>
      <button class="btn" onclick="exportAsImage()">
        <img src="https://img.icons8.com/ios/50/download.png" alt=""> T√©l√©charger
      </button>
    </div>
  </div>

<script>
let uploadedImages = [];
let currentLayout = 'pinterest';

function dragOverHandler(ev){ev.preventDefault();}
function dragLeaveHandler(ev){ev.preventDefault();}
function dropHandler(ev){ev.preventDefault(); if(ev.dataTransfer.files) fileChangeHandler(ev.dataTransfer.files);}
function fileChangeHandler(files){
  for(let f of files){
    if(!f.type.startsWith("image/")) continue;
    let reader=new FileReader();
    reader.onload=e=>{uploadedImages.push(e.target.result);updatePreview();};
    reader.readAsDataURL(f);
  }
}
function updatePreview(){
  let preview=document.getElementById("previewImages");
  preview.innerHTML="";
  uploadedImages.forEach((src,idx)=>{
    let div=document.createElement("div");
    div.className="preview-item";
    div.innerHTML=`<img src="${src}"><div class="remove-preview" onclick="removeImage(${idx})">√ó</div>`;
    preview.appendChild(div);
  });
}
function removeImage(i){uploadedImages.splice(i,1);updatePreview();generateMoodboard();}
function selectLayout(el,layout){
  currentLayout=layout;
  document.querySelectorAll('.layout-btn').forEach(btn=>btn.classList.remove('active'));
  el.classList.add('active');
  generateMoodboard();
}
function clearCanvas(){
  uploadedImages=[];
  updatePreview();
  document.getElementById("moodboardCanvas").innerHTML=`<div id="canvasPlaceholder" style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#a0aec0">Votre mood board appara√Ætra ici</div>`;
}
function shuffleLayout(){uploadedImages.sort(()=>Math.random()-0.5);generateMoodboard();}

function generateMoodboard(){
  let canvas=document.getElementById("moodboardCanvas");
  canvas.innerHTML="";
  if(!uploadedImages.length){
    canvas.innerHTML=`<div id="canvasPlaceholder" style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#a0aec0">Veuillez d'abord ajouter des images</div>`;
    return;
  }
  let w=canvas.clientWidth,h=canvas.clientHeight;

  if(currentLayout==="collage"){
    let gridSize=5;
    let cellW=w/gridSize,cellH=h/gridSize;
    let used=[];
    uploadedImages.forEach((src,i)=>{
      let cell;
      do{
        let cx=Math.floor(Math.random()*gridSize);
        let cy=Math.floor(Math.random()*gridSize);
        cell={x:cx,y:cy};
      }while(used.some(c=>c.x===cell.x && c.y===cell.y));
      used.push(cell);
      let x=cell.x*cellW+10, y=cell.y*cellH+10;
      let size=Math.min(cellW,cellH)-20;
      let img=document.createElement("div");
      img.className="image-item";
      img.style.width=size+"px";
      img.style.height=size+"px";
      img.style.left=x+"px";
      img.style.top=y+"px";
      img.style.transform=`rotate(${Math.random()*10-5}deg)`;
      img.innerHTML=`<img src="${src}">`;
      canvas.appendChild(img);
    });
  }
  else if(currentLayout==="grid" || currentLayout==="minimal"){
    let cols=3,rows=Math.ceil(uploadedImages.length/cols);
    let cellW=w/cols,cellH=h/rows;
    uploadedImages.forEach((src,i)=>{
      let img=document.createElement("div");
      img.className="image-item";
      img.style.left=(i%cols)*cellW+"px";
      img.style.top=Math.floor(i/cols)*cellH+"px";
      img.style.width=cellW+"px";
      img.style.height=cellH+"px";
      img.innerHTML=`<img src="${src}">`;
      canvas.appendChild(img);
    });
  }
  else if(currentLayout==="pinterest"){
    let colCount=4,colWidth=w/colCount;
    let colHeights=new Array(colCount).fill(0);
    uploadedImages.forEach((src,i)=>{
      let col=colHeights.indexOf(Math.min(...colHeights));
      let x=col*colWidth, y=colHeights[col];
      let imgH=150+Math.random()*100;
      let img=document.createElement("div");
      img.className="image-item";
      img.style.left=x+"px";
      img.style.top=y+"px";
      img.style.width=colWidth+"px";
      img.style.height=imgH+"px";
      img.innerHTML=`<img src="${src}">`;
      canvas.appendChild(img);
      colHeights[col]+=imgH+10;
    });
  }
}
function exportAsImage(){
  let canvas=document.getElementById("moodboardCanvas");
  html2canvas(canvas).then(c=>{
    let link=document.createElement("a");
    link.download="moodboard.png";
    link.href=c.toDataURL();
    link.click();
  });
}
</script>
</body>
</html>
