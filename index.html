<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>Moodboard Generator</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
  body {
    font-family: sans-serif;
    background: transparent; /* ‚úÖ Fond transparent pour Notion */
    margin: 0;
    padding: 10px;
    display: flex;
    justify-content: center;
  }
  .container {
    background: #fff;
    border-radius: 16px;
    padding: 16px;
    max-width: 900px;
    width: 100%;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  h1 {
    text-align: center;
    margin-bottom: 10px;
  }
  .upload {
    border: 2px dashed #ccc;
    padding: 16px;
    text-align: center;
    cursor: pointer;
    border-radius: 10px;
    margin-bottom: 20px;
  }
  .preview-images {
    display: flex;
    gap: 10px;
    overflow-x: auto;
    margin-bottom: 20px;
  }
  .preview-item {
    position: relative;
    min-width: 70px;
    height: 55px;
    border-radius: 6px;
    overflow: hidden;
    border: 2px solid transparent;
    cursor: pointer;
  }
  .preview-item img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    background: #f5f5f5;
  }
  .remove-preview {
    position: absolute;
    top: 4px;
    right: 4px;
    background: rgba(239,68,68,0.9);
    color: #fff;
    font-size: 12px;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
  }
  .controls h3 {
    margin-bottom: 8px;
    color: #4a5568;
    font-size: 1rem;
  }
  .layout-selector {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
    margin-bottom: 20px;
  }
  .layout-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    padding: 10px;
    background: #fff;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    cursor: pointer;
    transition: all .18s;
    color: #4a5568;
    font-size: 0.85rem;
    text-align: center;
  }
  .layout-btn.active {
    background: #E0EBDB;
    border-color: #E0EBDB;
    color: black;
  }
  .layout-preview {
    width: 36px;
    height: 26px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .moodboard-canvas {
    background: #f8fafc;
    border-radius: 12px;
    position: relative;
    height: 500px;
    overflow: hidden;
    margin-bottom: 20px;
  }
  .image-item {
    position: absolute;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 6px 14px rgba(0,0,0,0.12);
    background: #fff;
  }
  .image-item img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    background: #f5f5f5;
  }
  .image-controls {
    position: absolute;
    top: -6px;
    right: -6px;
    background: #E0EBDB;
    color: #000;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    cursor: pointer;
    opacity: 0;
  }
  .image-item:hover .image-controls {
    opacity: 1;
  }
  .actions {
    display: flex;
    gap: 8px;
    justify-content: center;
    flex-wrap: wrap;
  }
  .btn {
    padding: 8px 14px;
    border-radius: 8px;
    background: #E0EBDB;
    color: #000;
    border: none;
    cursor: pointer;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .btn img {
    width: 16px;
    height: 16px;
  }
  .btn-secondary {
    background: #718096;
    color: #fff;
  }
</style>
</head>
<body>
  <div class="container">
    <h1>üé® Moodboard Generator</h1>

    <!-- Upload -->
    <div class="upload" onclick="document.getElementById('fileInput').click()"
         ondrop="dropHandler(event)" ondragover="dragOverHandler(event)" ondragleave="dragLeaveHandler(event)">
      Cliquez ou d√©posez vos images ici
      <input id="fileInput" type="file" accept="image/*" multiple style="display:none"
             onchange="fileChangeHandler(this.files)">
    </div>

    <!-- Preview -->
    <div id="previewImages" class="preview-images"></div>

    <!-- Layout -->
    <div class="controls">
      <h3>Choisissez un style :</h3>
      <div class="layout-selector">
        <div class="layout-btn active" onclick="selectLayout(this,'pinterest')">
          <div class="layout-preview">üìå</div>Pinterest
        </div>
        <div class="layout-btn" onclick="selectLayout(this,'grid')">
          <div class="layout-preview">üî≤</div>Grille
        </div>
        <div class="layout-btn" onclick="selectLayout(this,'collage')">
          <div class="layout-preview">üñºÔ∏è</div>Collage
        </div>
        <div class="layout-btn" onclick="selectLayout(this,'minimal')">
          <div class="layout-preview">‚óºÔ∏è</div>Minimal
        </div>
      </div>
    </div>

    <!-- Canvas -->
    <div id="moodboardCanvas" class="moodboard-canvas">
      <div id="canvasPlaceholder" style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#a0aec0">
        Votre mood board appara√Ætra ici
      </div>
    </div>

    <!-- Actions -->
    <div class="actions">
      <button class="btn" onclick="generateMoodboard()">
        <img src="https://img.icons8.com/ios/50/sparkle.png" alt=""> G√©n√©rer
      </button>
      <button class="btn btn-secondary" onclick="shuffleLayout()">
        <img src="https://img.icons8.com/ios/50/shuffle.png" alt=""> M√©langer
      </button>
      <button class="btn btn-secondary" onclick="clearCanvas()">
        <img src="https://img.icons8.com/ios/50/trash.png" alt=""> Vider
      </button>
      <button class="btn" onclick="exportAsImage()">
        <img src="https://img.icons8.com/ios/50/download.png" alt=""> T√©l√©charger
      </button>
    </div>
  </div>

<script>
let uploadedImages = [];
let currentLayout = 'pinterest';

function dragOverHandler(ev) {
  ev.preventDefault();
  ev.currentTarget.style.background = "#e6fffa";
}
function dragLeaveHandler(ev) {
  ev.preventDefault();
  ev.currentTarget.style.background = "";
}
function dropHandler(ev) {
  ev.preventDefault();
  ev.currentTarget.style.background = "";
  if (ev.dataTransfer.files) fileChangeHandler(ev.dataTransfer.files);
}
function fileChangeHandler(files) {
  for (let f of files) {
    if (!f.type.startsWith("image/")) continue;
    let reader = new FileReader();
    reader.onload = e => {
      uploadedImages.push(e.target.result);
      updatePreview();
    };
    reader.readAsDataURL(f);
  }
}
function updatePreview() {
  let preview = document.getElementById("previewImages");
  preview.innerHTML = "";
  uploadedImages.forEach((src, idx) => {
    let div = document.createElement("div");
    div.className = "preview-item";
    div.innerHTML = `<img src="${src}"><div class="remove-preview" onclick="removeImage(${idx})">√ó</div>`;
    preview.appendChild(div);
  });
}
function removeImage(i) {
  uploadedImages.splice(i,1);
  updatePreview();
  generateMoodboard();
}
function selectLayout(el, layout) {
  currentLayout = layout;
  document.querySelectorAll('.layout-btn').forEach(btn => btn.classList.remove('active'));
  el.classList.add('active');
  generateMoodboard();
}
function clearCanvas() {
  uploadedImages = [];
  updatePreview();
  document.getElementById("moodboardCanvas").innerHTML =
    `<div id="canvasPlaceholder" style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#a0aec0">Votre mood board appara√Ætra ici</div>`;
}
function shuffleLayout() {
  uploadedImages.sort(() => Math.random()-0.5);
  generateMoodboard();
}
function generateMoodboard() {
  let canvas = document.getElementById("moodboardCanvas");
  canvas.innerHTML = "";
  if (!uploadedImages.length) {
    canvas.innerHTML = `<div id="canvasPlaceholder" style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#a0aec0">Veuillez d'abord ajouter des images</div>`;
    return;
  }
  let w = canvas.clientWidth, h = canvas.clientHeight;
  if (currentLayout === "grid" || currentLayout === "minimal") {
    let cols = 3, rows = Math.ceil(uploadedImages.length/cols);
    let cellW = w/cols, cellH = h/rows;
    uploadedImages.forEach((src, i) => {
      let img = document.createElement("div");
      img.className = "image-item";
      img.style.left = (i%cols)*cellW+"px";
      img.style.top = Math.floor(i/cols)*cellH+"px";
      img.style.width = cellW+"px";
      img.style.height = cellH+"px";
      img.innerHTML = `<img src="${src}"><div class="image-controls" onclick="removeImage(${i})">√ó</div>`;
      canvas.appendChild(img);
    });
  } else if (currentLayout === "pinterest") {
    let colCount = 4;
    let colWidth = w/colCount;
    let colHeights = new Array(colCount).fill(0);
    uploadedImages.forEach((src,i) => {
      let col = colHeights.indexOf(Math.min(...colHeights));
      let x = col*colWidth, y = colHeights[col];
      let imgH = 150+Math.random()*100;
      let img = document.createElement("div");
      img.className = "image-item";
      img.style.left = x+"px";
      img.style.top = y+"px";
      img.style.width = colWidth+"px";
      img.style.height = imgH+"px";
      img.innerHTML = `<img src="${src}"><div class="image-controls" onclick="removeImage(${i})">√ó</div>`;
      canvas.appendChild(img);
      colHeights[col]+=imgH+10;
    });
  } else if (currentLayout === "collage") {
    let placed = [];
    uploadedImages.forEach((src,i) => {
      let img = document.createElement("div");
      img.className = "image-item";
      let size = 120+Math.random()*150;
      let tries = 0, x, y, overlap;
      do {
        x = Math.random()*(w-size);
        y = Math.random()*(h-size);
        overlap = placed.some(p => !(x+size<p.x || p.x+p.w<x || y+size<p.y || p.y+p.h<y));
        tries++;
      } while(overlap && tries<50);
      placed.push({x,y,w:size,h:size});
      img.style.width = size+"px";
      img.style.height = size+"px";
      img.style.left = x+"px";
      img.style.top = y+"px";
      img.style.transform = `rotate(${Math.random()*20-10}deg)`;
      img.innerHTML = `<img src="${src}"><div class="image-controls" onclick="removeImage(${i})">√ó</div>`;
      canvas.appendChild(img);
    });
  }
}
function exportAsImage() {
  let canvas = document.getElementById("moodboardCanvas");
  html2canvas(canvas).then(c => {
    let link = document.createElement("a");
    link.download = "moodboard.png";
    link.href = c.toDataURL();
    link.click();
  });
}
</script>
</body>
</html>
